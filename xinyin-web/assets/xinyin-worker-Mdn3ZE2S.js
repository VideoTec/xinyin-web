const K="sks";let w=null;async function X(){w=await(await(await navigator.storage.getDirectory()).getFileHandle(K,{create:!0})).createSyncAccessHandle()}function $(){w?.truncate(0)}function Q(e){let n=w?.getSize(),t=new TextEncoder().encode(e+`
`);w?.write(t,{at:n}),w?.flush()}function L(){let e=[];if(!w)return e;let n=w?.getSize(),t=new ArrayBuffer(n);return w?.read(t,{at:0}),e=new TextDecoder().decode(new Uint8Array(t)).split(`
`).filter(r=>r.trim()!==""),e}let o,x=null;function E(){return(x===null||x.byteLength===0)&&(x=new Uint8Array(o.memory.buffer)),x}function U(e,n){return e=e>>>0,E().subarray(e/1,e/1+n)}function V(e){const n=o.__externref_table_alloc();return o.__wbindgen_export_2.set(n,e),n}function Z(e,n){try{return e.apply(this,n)}catch(t){const s=V(t);o.__wbindgen_exn_store(s)}}let y=null;function T(){return(y===null||y.buffer.detached===!0||y.buffer.detached===void 0&&y.buffer!==o.memory.buffer)&&(y=new DataView(o.memory.buffer)),y}let _=0;function ee(e,n){const t=n(e.length*4,4)>>>0;for(let s=0;s<e.length;s++){const r=V(e[s]);T().setUint32(t+4*s,r,!0)}return _=e.length,t}const F=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&F.decode();function S(e,n){return e=e>>>0,F.decode(E().subarray(e,e+n))}const M=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ne=typeof M.encodeInto=="function"?function(e,n){return M.encodeInto(e,n)}:function(e,n){const t=M.encode(e);return n.set(t),{read:e.length,written:t.length}};function p(e,n,t){if(t===void 0){const c=M.encode(e),f=n(c.length,1)>>>0;return E().subarray(f,f+c.length).set(c),_=c.length,f}let s=e.length,r=n(s,1)>>>0;const l=E();let i=0;for(;i<s;i++){const c=e.charCodeAt(i);if(c>127)break;l[r+i]=c}if(i!==s){i!==0&&(e=e.slice(i)),r=t(r,s,s=i+e.length*3,1)>>>0;const c=E().subarray(r+i,r+s),f=ne(e,c);i+=f.written,r=t(r,s,i,1)>>>0}return _=i,r}function te(e){return e==null}function re(e,n){const t=n(e.length*1,1)>>>0;return E().set(e,t/1),_=e.length,t}function z(e){const n=o.__wbindgen_export_2.get(e);return o.__externref_table_dealloc(e),n}function se(e,n,t){const s=p(e,o.__wbindgen_malloc,o.__wbindgen_realloc),r=_,l=re(n,o.__wbindgen_malloc),i=_,c=p(t,o.__wbindgen_malloc,o.__wbindgen_realloc),f=_,a=o.sign_message(s,r,l,i,c,f);if(a[3])throw z(a[2]);var u=U(a[0],a[1]).slice();return o.__wbindgen_free(a[0],a[1]*1,1),u}function oe(e,n,t,s,r){let l,i;try{const a=p(e,o.__wbindgen_malloc,o.__wbindgen_realloc),u=_,g=p(n,o.__wbindgen_malloc,o.__wbindgen_realloc),d=_,b=p(r,o.__wbindgen_malloc,o.__wbindgen_realloc),J=_,k=o.import_xinyin_words32(a,u,g,d,t,s,b,J);var c=k[0],f=k[1];if(k[3])throw c=0,f=0,z(k[2]);return l=c,i=f,S(c,f)}finally{o.__wbindgen_free(l,i,1)}}function ie(e,n,t){let s,r;try{const c=p(e,o.__wbindgen_malloc,o.__wbindgen_realloc),f=_,a=o.generate_xinyin_words32(c,f,n,t);var l=a[0],i=a[1];if(a[3])throw l=0,i=0,z(a[2]);return s=l,r=i,S(l,i)}finally{o.__wbindgen_free(s,r,1)}}async function ae(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(s){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function ce(){const e={};return e.wbg={},e.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return Z(function(n,t){globalThis.crypto.getRandomValues(U(n,t))},arguments)},e.wbg.__wbg_loadEncryptedSks_1d471d02e256749d=function(n){const t=L(),s=ee(t,o.__wbindgen_malloc),r=_;T().setInt32(n+4*1,r,!0),T().setInt32(n+4*0,s,!0)},e.wbg.__wbg_saveEncryptedSkBase64_7db92d0beb3ceff7=function(n,t){Q(S(n,t))},e.wbg.__wbindgen_init_externref_table=function(){const n=o.__wbindgen_export_2,t=n.grow(4);n.set(0,void 0),n.set(t+0,void 0),n.set(t+1,null),n.set(t+2,!0),n.set(t+3,!1)},e.wbg.__wbindgen_string_get=function(n,t){const s=t,r=typeof s=="string"?s:void 0;var l=te(r)?0:p(r,o.__wbindgen_malloc,o.__wbindgen_realloc),i=_;T().setInt32(n+4*1,i,!0),T().setInt32(n+4*0,l,!0)},e.wbg.__wbindgen_string_new=function(n,t){return S(n,t)},e.wbg.__wbindgen_throw=function(n,t){throw new Error(S(n,t))},e}function le(e,n){return o=e.exports,H.__wbindgen_wasm_module=n,y=null,x=null,o.__wbindgen_start(),o}async function H(e){if(o!==void 0)return o;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("xinyin-wasm_bg.wasm",import.meta.url));const n=ce();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:s}=await ae(await e,n);return le(t,s)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const N=Symbol("Comlink.proxy"),fe=Symbol("Comlink.endpoint"),ue=Symbol("Comlink.releaseProxy"),C=Symbol("Comlink.finalizer"),R=Symbol("Comlink.thrown"),j=e=>typeof e=="object"&&e!==null||typeof e=="function",de={canHandle:e=>j(e)&&e[N],serialize(e){const{port1:n,port2:t}=new MessageChannel;return D(e,n),[t,[t]]},deserialize(e){return e.start(),be(e)}},ge={canHandle:e=>j(e)&&R in e,serialize({value:e}){let n;return e instanceof Error?n={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:n={isError:!1,value:e},[n,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},B=new Map([["proxy",de],["throw",ge]]);function _e(e,n){for(const t of e)if(n===t||t==="*"||t instanceof RegExp&&t.test(n))return!0;return!1}function D(e,n=globalThis,t=["*"]){n.addEventListener("message",function s(r){if(!r||!r.data)return;if(!_e(t,r.origin)){console.warn(`Invalid origin '${r.origin}' for comlink proxy`);return}const{id:l,type:i,path:c}=Object.assign({path:[]},r.data),f=(r.data.argumentList||[]).map(m);let a;try{const u=c.slice(0,-1).reduce((d,b)=>d[b],e),g=c.reduce((d,b)=>d[b],e);switch(i){case"GET":a=g;break;case"SET":u[c.slice(-1)[0]]=m(r.data.value),a=!0;break;case"APPLY":a=g.apply(u,f);break;case"CONSTRUCT":{const d=new g(...f);a=Ee(d)}break;case"ENDPOINT":{const{port1:d,port2:b}=new MessageChannel;D(e,b),a=he(d,[d])}break;case"RELEASE":a=void 0;break;default:return}}catch(u){a={value:u,[R]:0}}Promise.resolve(a).catch(u=>({value:u,[R]:0})).then(u=>{const[g,d]=P(u);n.postMessage(Object.assign(Object.assign({},g),{id:l}),d),i==="RELEASE"&&(n.removeEventListener("message",s),q(n),C in e&&typeof e[C]=="function"&&e[C]())}).catch(u=>{const[g,d]=P({value:new TypeError("Unserializable return value"),[R]:0});n.postMessage(Object.assign(Object.assign({},g),{id:l}),d)})}),n.start&&n.start()}function we(e){return e.constructor.name==="MessagePort"}function q(e){we(e)&&e.close()}function be(e,n){const t=new Map;return e.addEventListener("message",function(r){const{data:l}=r;if(!l||!l.id)return;const i=t.get(l.id);if(i)try{i(l)}finally{t.delete(l.id)}}),v(e,t,[],n)}function A(e){if(e)throw new Error("Proxy has been released and is not useable")}function G(e){return h(e,new Map,{type:"RELEASE"}).then(()=>{q(e)})}const O=new WeakMap,W="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const n=(O.get(e)||0)-1;O.set(e,n),n===0&&G(e)});function ye(e,n){const t=(O.get(n)||0)+1;O.set(n,t),W&&W.register(e,n,e)}function me(e){W&&W.unregister(e)}function v(e,n,t=[],s=function(){}){let r=!1;const l=new Proxy(s,{get(i,c){if(A(r),c===ue)return()=>{me(l),G(e),n.clear(),r=!0};if(c==="then"){if(t.length===0)return{then:()=>l};const f=h(e,n,{type:"GET",path:t.map(a=>a.toString())}).then(m);return f.then.bind(f)}return v(e,n,[...t,c])},set(i,c,f){A(r);const[a,u]=P(f);return h(e,n,{type:"SET",path:[...t,c].map(g=>g.toString()),value:a},u).then(m)},apply(i,c,f){A(r);const a=t[t.length-1];if(a===fe)return h(e,n,{type:"ENDPOINT"}).then(m);if(a==="bind")return v(e,n,t.slice(0,-1));const[u,g]=I(f);return h(e,n,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:u},g).then(m)},construct(i,c){A(r);const[f,a]=I(c);return h(e,n,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:f},a).then(m)}});return ye(l,e),l}function pe(e){return Array.prototype.concat.apply([],e)}function I(e){const n=e.map(P);return[n.map(t=>t[0]),pe(n.map(t=>t[1]))]}const Y=new WeakMap;function he(e,n){return Y.set(e,n),e}function Ee(e){return Object.assign(e,{[N]:!0})}function P(e){for(const[n,t]of B)if(t.canHandle(e)){const[s,r]=t.serialize(e);return[{type:"HANDLER",name:n,value:s},r]}return[{type:"RAW",value:e},Y.get(e)||[]]}function m(e){switch(e.type){case"HANDLER":return B.get(e.name).deserialize(e.value);case"RAW":return e.value}}function h(e,n,t,s){return new Promise(r=>{const l=xe();n.set(l,r),e.start&&e.start(),e.postMessage(Object.assign({id:l},t),s)})}function xe(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}async function Te(){return await X(),await H({module_or_path:"../xinyin-wasm.wasm"}),!0}const Se={init:Te,importWords32:oe,generateWords32:ie,signMessage:se,loadEncryptedSks:L,clearSksCache:$};D(Se);
//# sourceMappingURL=xinyin-worker-Mdn3ZE2S.js.map
