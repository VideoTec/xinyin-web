const C="sks",b=await async function(){return await(await(await navigator.storage.getDirectory()).getFileHandle(C,{create:!0})).createSyncAccessHandle()}();function O(){b.truncate(0)}function H(e){let n=b.getSize(),t=new TextEncoder().encode(e+`
`);b.write(t,{at:n}),b.flush()}function W(){let e=b.getSize(),n=new ArrayBuffer(e);return b.read(n,{at:0}),new TextDecoder().decode(new Uint8Array(n)).split(`
`).filter(o=>o.trim()!=="")}let r,y=null;function g(){return(y===null||y.byteLength===0)&&(y=new Uint8Array(r.memory.buffer)),y}function R(e,n){return e=e>>>0,g().subarray(e/1,e/1+n)}function T(e){const n=r.__externref_table_alloc();return r.__wbindgen_export_2.set(n,e),n}function D(e,n){try{return e.apply(this,n)}catch(t){const s=T(t);r.__wbindgen_exn_store(s)}}let _=null;function p(){return(_===null||_.buffer.detached===!0||_.buffer.detached===void 0&&_.buffer!==r.memory.buffer)&&(_=new DataView(r.memory.buffer)),_}let f=0;function L(e,n){const t=n(e.length*4,4)>>>0;for(let s=0;s<e.length;s++){const o=T(e[s]);p().setUint32(t+4*s,o,!0)}return f=e.length,t}const A=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&A.decode();function h(e,n){return e=e>>>0,A.decode(g().subarray(e,e+n))}const m=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},V=typeof m.encodeInto=="function"?function(e,n){return m.encodeInto(e,n)}:function(e,n){const t=m.encode(e);return n.set(t),{read:e.length,written:t.length}};function w(e,n,t){if(t===void 0){const a=m.encode(e),c=n(a.length,1)>>>0;return g().subarray(c,c+a.length).set(a),f=a.length,c}let s=e.length,o=n(s,1)>>>0;const u=g();let i=0;for(;i<s;i++){const a=e.charCodeAt(i);if(a>127)break;u[o+i]=a}if(i!==s){i!==0&&(e=e.slice(i)),o=t(o,s,s=i+e.length*3,1)>>>0;const a=g().subarray(o+i,o+s),c=V(e,a);i+=c.written,o=t(o,s,i,1)>>>0}return f=i,o}function q(e){return e==null}function z(e,n){const t=n(e.length*1,1)>>>0;return g().set(e,t/1),f=e.length,t}function S(e){const n=r.__wbindgen_export_2.get(e);return r.__externref_table_dealloc(e),n}function B(e,n,t){const s=w(e,r.__wbindgen_malloc,r.__wbindgen_realloc),o=f,u=z(n,r.__wbindgen_malloc),i=f,a=w(t,r.__wbindgen_malloc,r.__wbindgen_realloc),c=f,d=r.sign_message(s,o,u,i,a,c);if(d[3])throw S(d[2]);var x=R(d[0],d[1]).slice();return r.__wbindgen_free(d[0],d[1]*1,1),x}function j(e,n,t,s,o){let u,i;try{const d=w(e,r.__wbindgen_malloc,r.__wbindgen_realloc),x=f,E=w(n,r.__wbindgen_malloc,r.__wbindgen_realloc),v=f,F=w(o,r.__wbindgen_malloc,r.__wbindgen_realloc),U=f,k=r.import_xinyin_words32(d,x,E,v,t,s,F,U);var a=k[0],c=k[1];if(k[3])throw a=0,c=0,S(k[2]);return u=a,i=c,h(a,c)}finally{r.__wbindgen_free(u,i,1)}}function G(e,n,t){let s,o;try{const a=w(e,r.__wbindgen_malloc,r.__wbindgen_realloc),c=f,d=r.generate_xinyin_words32(a,c,n,t);var u=d[0],i=d[1];if(d[3])throw u=0,i=0,S(d[2]);return s=u,o=i,h(u,i)}finally{r.__wbindgen_free(s,o,1)}}async function N(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(s){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function X(){const e={};return e.wbg={},e.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return D(function(n,t){globalThis.crypto.getRandomValues(R(n,t))},arguments)},e.wbg.__wbg_loadEncryptedSks_bc4fb8cc4e1e00ef=function(n){const t=W(),s=L(t,r.__wbindgen_malloc),o=f;p().setInt32(n+4*1,o,!0),p().setInt32(n+4*0,s,!0)},e.wbg.__wbg_saveEncryptedSkBase64_548607f5d2c7d1c7=function(n,t){H(h(n,t))},e.wbg.__wbindgen_init_externref_table=function(){const n=r.__wbindgen_export_2,t=n.grow(4);n.set(0,void 0),n.set(t+0,void 0),n.set(t+1,null),n.set(t+2,!0),n.set(t+3,!1)},e.wbg.__wbindgen_string_get=function(n,t){const s=t,o=typeof s=="string"?s:void 0;var u=q(o)?0:w(o,r.__wbindgen_malloc,r.__wbindgen_realloc),i=f;p().setInt32(n+4*1,i,!0),p().setInt32(n+4*0,u,!0)},e.wbg.__wbindgen_string_new=function(n,t){return h(n,t)},e.wbg.__wbindgen_throw=function(n,t){throw new Error(h(n,t))},e}function Y(e,n){return r=e.exports,I.__wbindgen_wasm_module=n,_=null,y=null,r.__wbindgen_start(),r}async function I(e){if(r!==void 0)return r;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("xinyinWasm_bg.wasm",import.meta.url));const n=X();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:s}=await N(await e,n);return Y(t,s)}const l={GenerateWords32:"generate-words32",GenerateWords32Result:"words32-generated-result",ImportWords32:"import-words32",ImportWords32Result:"words32-imported-result",SignMessage:"sign-message",SignMessageResult:"message-signed-result",ListSks:"list-sks",ListSksResult:"sks-listed-result",ClearSksCache:"clear-sks-cache",ClearSksCacheResult:"sks-cache-cleared-result",WorkerReady:"worker-ready",Unknown:"unknown"};I({module_or_path:"../xinyin/xinyinWasm.wasm"}).then(()=>{M({code:l.WorkerReady,requestId:-1})}).catch(e=>{M({code:l.WorkerReady,requestId:-1,errorMessage:`初始化 wasm 模块失败: ${e}`})});self.onmessage=e=>{$(e.data)};function M(e){self.postMessage(e)}function $(e){let n={code:l.Unknown,requestId:e.requestId};switch(e.code){case l.GenerateWords32:{if(n.code=l.GenerateWords32Result,e.txtInHeart===void 0||e.startOf8105===void 0||e.countFrom8105===void 0){n.errorMessage="缺少必要的参数: txtInHeart, startOf8105, countFrom8105";break}try{n.words32=G(e.txtInHeart,e.startOf8105,e.countFrom8105)}catch(t){n.errorMessage=t}break}case l.ImportWords32:{if(n.code=l.ImportWords32Result,e.words32===void 0||e.txtInHeart===void 0||e.startOf8105===void 0||e.countFrom8105===void 0||e.passphrase===void 0){n.errorMessage="缺少必要的参数: words32, txtInHeart, startOf8105, countFrom8105, passphrase";break}try{n.solanaAddress=j(e.words32,e.txtInHeart,e.startOf8105,e.countFrom8105,e.passphrase)}catch(t){n.errorMessage=t}break}case l.SignMessage:{if(n.code=l.SignMessageResult,e.solanaAddress===void 0||e.messageUint8===void 0||e.passphrase===void 0){n.errorMessage="缺少必要的参数: solanaAddress, messageUint8, passphrase";break}try{n.signature=B(e.solanaAddress,e.messageUint8,e.passphrase)}catch(t){n.errorMessage=t}break}case l.ClearSksCache:{n.code=l.ClearSksCacheResult,O();break}case l.ListSks:{n.code=l.ListSksResult;try{n.sks=W()}catch(t){n.errorMessage=t}break}default:n.errorMessage=`未知的消息类型: ${e.code}`}self.postMessage(n)}
//# sourceMappingURL=xinyinWorker-B76aSSsx.js.map
